import AddPostForm from "@/components/AddPostForm/AddPostForm";
import PostCard from "@/components/PostCard/PostCard";
import { Divider, Grid, Typography } from "@mui/material";

async function getAllPosts() {
  const res = await fetch(`http://localhost:3000/api/posts`, { cache: "no-store" })
 
  if (!res.ok) {
    throw new Error('Failed to fetch data')
  }
  return res.json()
}

interface Post {
  id: number;
  title: string;
  comment: string;
}

export default async function Home() {
  const posts = await getAllPosts();

  return (
    <div>
      <Typography variant="h3" sx={{ textAlign: 'center', marginTop: 10 }}>Bienvenue sur mon application vraiment très sécurisée</Typography>

      <Typography variant="h4" sx={{ textAlign: 'center', marginTop: 10 }}>Liste des posts</Typography>

      <Grid container spacing={3} marginTop={3} marginBottom={3}>
          {posts.results.map((post: Post) => (
            <Grid item xs={12} sm={6} md={4} key={post.id}>
              <PostCard post={post} />
            </Grid>
          ))}
      </Grid>

      <Divider sx={{ marginTop: 5 }} />

      <AddPostForm />
    </div>
  );
}